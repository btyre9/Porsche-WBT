<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=1920">
  <title>Knowledge Check 1</title>
  <style>
    @font-face {
      font-family: "Porsche Next TT";
      src: url("../../assets/fonts/porsche-next-tt.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: block;
    }
    @font-face {
      font-family: "Porsche Next TT";
      src: url("../../assets/fonts/porsche-next-tt-bold.ttf") format("truetype");
      font-weight: 700;
      font-style: normal;
      font-display: block;
    }

    :root {
      --bg-0: #111317;
      --bg-1: #1e2128;
      --bg-2: #2a2f39;
      --text-strong: #ffffff;
      --text-body: rgba(255, 255, 255, 0.9);
      --text-muted: rgba(255, 255, 255, 0.60);
      --card-bg: rgba(255, 255, 255, 0.05);
      --card-border: rgba(255, 255, 255, 0.12);
      --accent: #d5001c;
      --green: #22c55e;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      width: 1920px;
      height: 920px;
      overflow: hidden;
      font-family: "Porsche Next TT", Arial, Helvetica, sans-serif;
    }

    /* ── Full-slide backdrop ─────────────────────────────────── */
    .backdrop {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(1400px 700px at 10% -10%, #343a48 0%, transparent 60%),
        linear-gradient(140deg, var(--bg-0) 0%, var(--bg-1) 48%, var(--bg-2) 100%);
    }

    /* Subtle grid */
    .backdrop::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(255, 255, 255, 0.015) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.015) 1px, transparent 1px);
      background-size: 48px 48px;
      pointer-events: none;
    }

    /* Dim overlay — makes the modal feel elevated above the content below */
    .backdrop::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.52);
    }

    /* ── Slide shell (scale target) ──────────────────────────── */
    .slide {
      position: relative;
      width: 1920px;
      height: 920px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* ── Modal card ──────────────────────────────────────────── */
    .modal-card {
      position: relative;
      z-index: 10;
      width: 1080px;
      background: #1e2128;
      border: 1px solid rgba(255, 255, 255, 0.14);
      border-radius: 20px;
      box-shadow:
        0 32px 80px rgba(0, 0, 0, 0.55),
        0 0 0 1px rgba(255, 255, 255, 0.06) inset;
      display: flex;
      flex-direction: column;
      overflow: hidden;

      /* Entrance animation */
      opacity: 0;
      transform: translateY(24px) scale(0.98);
      transition: opacity 0.45s ease, transform 0.45s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .modal-card.is-visible {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    /* ── Modal header bar ────────────────────────────────────── */
    .modal-header {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 32px;
      background: var(--accent);
      border-radius: 20px 20px 0 0;
    }

    .modal-header__title {
      margin: 0;
      font-size: 32px;
      font-weight: 700;
      color: #fff;
    }

    /* ── Modal body ──────────────────────────────────────────── */
    .modal-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 32px 36px 28px;
    }

    /* ── Question stem ───────────────────────────────────────── */
    .question-stem {
      flex-shrink: 0;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.10);
    }

    .question-stem__label {
      display: block;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .question-stem__text {
      margin: 0;
      font-size: 21px;
      line-height: 1.5;
      color: var(--text-strong);
    }

    /* ── Options list ────────────────────────────────────────── */
    .options-list {
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* ── Option row ──────────────────────────────────────────── */
    .option-row {
      display: flex;
      align-items: center;
      gap: 18px;
      padding: 16px 22px;
      background: rgba(255, 255, 255, 0.04);
      border: 1.5px solid rgba(255, 255, 255, 0.10);
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      transition: border-color 0.18s ease, background 0.18s ease, transform 0.12s ease;
    }

    .option-row:hover:not(.is-locked) {
      border-color: rgba(255, 255, 255, 0.28);
      background: rgba(255, 255, 255, 0.07);
    }

    .option-row:active:not(.is-locked) {
      transform: scale(0.995);
    }

    .option-row.is-selected {
      border-color: rgba(255, 255, 255, 0.50);
      background: rgba(255, 255, 255, 0.08);
    }

    .option-row.is-correct {
      border-color: rgba(34, 197, 94, 0.65);
      background: rgba(34, 197, 94, 0.08);
    }

    .option-row.is-incorrect {
      border-color: rgba(239, 68, 68, 0.55);
      background: rgba(239, 68, 68, 0.07);
    }

    .option-row.is-dimmed {
      opacity: 0.38;
    }

    .option-row.is-locked {
      cursor: default;
    }

    /* Letter badge */
    .option-row__letter {
      flex-shrink: 0;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1.5px solid rgba(255, 255, 255, 0.16);
      background: rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      color: var(--text-muted);
      transition: background 0.18s, border-color 0.18s, color 0.18s;
    }

    .option-row.is-selected  .option-row__letter { border-color: rgba(255,255,255,0.55); background: rgba(255,255,255,0.10); color: #fff; }
    .option-row.is-correct   .option-row__letter { border-color: rgba(34,197,94,0.65);   background: rgba(34,197,94,0.16);  color: var(--green); }
    .option-row.is-incorrect .option-row__letter { border-color: rgba(239,68,68,0.55);   background: rgba(239,68,68,0.14);  color: #ef4444; }

    /* Option text */
    .option-row__text {
      font-size: 19px;
      font-weight: 600;
      color: var(--text-body);
      line-height: 1.3;
      transition: color 0.18s;
    }

    .option-row.is-correct   .option-row__text { color: var(--green); }
    .option-row.is-incorrect .option-row__text { color: #ef4444; }

    /* ── Feedback strip ──────────────────────────────────────── */
    .feedback-strip {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 0 20px;
      border-radius: 8px;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.4s ease, opacity 0.3s ease 0.1s, padding 0.3s ease;
    }

    .feedback-strip.is-visible {
      max-height: 80px;
      opacity: 1;
      padding: 16px 20px;
    }

    .feedback-strip--correct  { background: rgba(34, 197, 94, 0.09);  border: 1px solid rgba(34, 197, 94, 0.35); }
    .feedback-strip--incorrect { background: rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.30); }

    .feedback-strip__icon {
      flex-shrink: 0;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
    }

    .feedback-strip--correct  .feedback-strip__icon { background: rgba(34,197,94,0.18); color: var(--green); }
    .feedback-strip--incorrect .feedback-strip__icon { background: rgba(239,68,68,0.14); color: #ef4444; }

    .feedback-strip__text {
      margin: 0;
      font-size: 17px;
      line-height: 1.5;
      color: var(--text-body);
    }

    .feedback-strip__text strong { color: var(--text-strong); }

    /* ── Modal footer ────────────────────────────────────────── */
    .modal-footer {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 36px 28px;
    }

    /* ── Submit button ───────────────────────────────────────── */
    .submit-btn {
      padding: 13px 38px;
      background: var(--accent);
      border: none;
      border-radius: 7px;
      font-family: inherit;
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0.03em;
      cursor: pointer;
      opacity: 0.32;
      pointer-events: none;
      transition: background 0.2s, opacity 0.25s, transform 0.12s;
    }

    .submit-btn.is-ready {
      opacity: 1;
      pointer-events: auto;
    }

    .submit-btn.is-ready:hover  { background: #b8001a; }
    .submit-btn.is-ready:active { transform: scale(0.98); }

    .submit-btn.is-submitted {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-muted);
      opacity: 0.65;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <div class="slide" data-slide-id="KC-CC01-001" data-review-slide="SLD-CC01-008">

    <!-- Dimmed backdrop -->
    <div class="backdrop"></div>

    <!-- Modal card -->
    <div class="modal-card" id="modal-card" role="dialog" aria-modal="true" aria-labelledby="modal-title">

      <!-- Header bar -->
      <div class="modal-header">
        <h2 class="modal-header__title" id="modal-title">Knowledge Check</h2>
      </div>

      <!-- Body -->
      <div class="modal-body">

        <!-- Question stem -->
        <div class="question-stem">
          <span class="question-stem__label">Question 1</span>
          <p class="question-stem__text">Which CSI dimension represents the largest single factor in customer satisfaction, and what percentage of the total score does it represent?</p>
        </div>

        <!-- Options -->
        <div class="options-list" id="options-list" role="radiogroup" aria-label="Answer options">

          <div class="option-row" data-value="A" role="radio" aria-checked="false" tabindex="0">
            <div class="option-row__letter">A</div>
            <span class="option-row__text">Service Advisor</span>
          </div>

          <div class="option-row" data-value="B" role="radio" aria-checked="false" tabindex="0">
            <div class="option-row__letter">B</div>
            <span class="option-row__text">Vehicle Pick Up</span>
          </div>

          <div class="option-row" data-value="C" data-correct="true" role="radio" aria-checked="false" tabindex="0">
            <div class="option-row__letter">C</div>
            <span class="option-row__text">Service Quality</span>
          </div>

          <div class="option-row" data-value="D" role="radio" aria-checked="false" tabindex="0">
            <div class="option-row__letter">D</div>
            <span class="option-row__text">Service Initiation</span>
          </div>

        </div><!-- /.options-list -->

        <!-- Feedback -->
        <div class="feedback-strip" id="feedback-strip" role="alert" aria-live="polite" aria-atomic="true">
          <div class="feedback-strip__icon" id="feedback-icon"></div>
          <p class="feedback-strip__text" id="feedback-text"></p>
        </div>

      </div><!-- /.modal-body -->

      <!-- Footer -->
      <div class="modal-footer">
        <button class="submit-btn" id="submit-btn" disabled aria-disabled="true">Submit Answer</button>
      </div>

    </div><!-- /.modal-card -->

  </div><!-- /.slide -->

  <!-- Scale to viewport -->
  <script>
    (function () {
      var slide = document.querySelector('[data-slide-id]');
      function scaleSlide() {
        var s = Math.min(window.innerWidth / 1920, window.innerHeight / 920);
        slide.style.transform       = 'scale(' + s + ')';
        slide.style.transformOrigin = 'top left';
        slide.style.marginLeft      = ((window.innerWidth  - 1920 * s) / 2) + 'px';
        slide.style.marginTop       = ((window.innerHeight -  920 * s) / 2) + 'px';
      }
      window.addEventListener('resize', scaleSlide);
      scaleSlide();
    })();
  </script>

  <!-- Modal entrance -->
  <script>
    setTimeout(function () {
      document.getElementById('modal-card').classList.add('is-visible');
    }, 120);
  </script>

  <!-- Quiz logic -->
  <script>
    (function () {
      var CORRECT = 'C'; // Updated after shuffle to reflect new label

      var FEEDBACK = {
        correct:   '<strong>Correct!</strong>',
        incorrect: 'Not quite, let\'s go back to review.'
      };

      // Randomize option order, then re-label A–D in new visual order
      (function shuffleOptions() {
        var list = document.getElementById('options-list');
        var items = Array.from(list.querySelectorAll('.option-row'));
        for (var i = items.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          list.appendChild(items[j]);
          var tmp = items[i]; items[i] = items[j]; items[j] = tmp;
        }
        // Re-assign letters to match new positions
        var letters = ['A', 'B', 'C', 'D'];
        items.forEach(function (row, idx) {
          row.dataset.value = letters[idx];
          row.querySelector('.option-row__letter').textContent = letters[idx];
          if (row.dataset.correct === 'true') {
            CORRECT = letters[idx];
          }
        });
      })();

      var selected  = null;
      var submitted = false;

      var rows         = document.querySelectorAll('.option-row');
      var submitBtn    = document.getElementById('submit-btn');
      var feedbackStrip = document.getElementById('feedback-strip');
      var feedbackIcon = document.getElementById('feedback-icon');
      var feedbackText = document.getElementById('feedback-text');

      function selectOption(row) {
        if (submitted) return;
        rows.forEach(function (r) {
          r.classList.remove('is-selected');
          r.setAttribute('aria-checked', 'false');
        });
        row.classList.add('is-selected');
        row.setAttribute('aria-checked', 'true');
        selected = row.dataset.value;
        submitBtn.classList.add('is-ready');
        submitBtn.removeAttribute('disabled');
        submitBtn.setAttribute('aria-disabled', 'false');
      }

      function handleSubmit() {
        if (!selected || submitted) return;
        submitted = true;
        var isCorrect = (selected === CORRECT);

        // Lock all options
        rows.forEach(function (r) {
          r.classList.add('is-locked');
          r.setAttribute('tabindex', '-1');
        });

        // Apply result states
        rows.forEach(function (r) {
          r.classList.remove('is-selected');
          if (r.dataset.value === selected) {
            r.classList.add(isCorrect ? 'is-correct' : 'is-incorrect');
          } else {
            r.classList.add('is-dimmed');
          }
        });

        // Show feedback
        var type = isCorrect ? 'correct' : 'incorrect';
        feedbackStrip.classList.add('feedback-strip--' + type, 'is-visible');
        feedbackIcon.textContent = isCorrect ? '✓' : '✗';
        feedbackText.innerHTML   = FEEDBACK[type];

        // Play KC response VO
        var kcAudio = new Audio('../audio/vo/kc-' + type + '-response.mp3');
        kcAudio.play().catch(function (e) {
          console.warn('[KC] Could not play response audio:', e);
        });

        // Update button
        submitBtn.classList.remove('is-ready');
        if (isCorrect) {
          submitBtn.classList.add('is-submitted');
          submitBtn.disabled = true;
          submitBtn.setAttribute('aria-disabled', 'true');
          submitBtn.textContent = 'Correct ✓';
        } else {
          submitBtn.classList.add('is-ready');
          submitBtn.disabled = false;
          submitBtn.removeAttribute('disabled');
          submitBtn.setAttribute('aria-disabled', 'false');
          submitBtn.textContent = 'Back to Review ←';
          submitBtn.addEventListener('click', function () {
            var reviewSlide = (document.querySelector('[data-review-slide]') || {}).dataset.reviewSlide;
            if (reviewSlide && window.parent && window.parent.CourseRuntime) {
              window.parent.CourseRuntime.goToSlideId(reviewSlide);
            }
          }, { once: true });
        }
      }

      rows.forEach(function (row) {
        row.addEventListener('click', function () { selectOption(row); });
        row.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectOption(row);
          }
        });
      });

      submitBtn.addEventListener('click', handleSubmit);
      submitBtn.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          handleSubmit();
        }
      });
    })();
  </script>

  <script src="../../assets/vendor/gsap/gsap.min.js"></script>
  <script src="../sandbox-runtime.js"></script>
  <script>
    SandboxRuntime.init("KC-CC01-001", {
      autoplay: false,
      basePath: "../"
    });
  </script>
</body>
</html>
