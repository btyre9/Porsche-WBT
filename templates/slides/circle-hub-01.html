<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>{{ slide.slide_title }}</title>
<style>
  @font-face {
    font-family: 'Porsche Next TT';
    src: local('Porsche Next TT');
    font-weight: 400;
  }
  @font-face {
    font-family: 'Porsche Next TT';
    src: local('Porsche Next TT Bold');
    font-weight: 700;
  }
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { width: 100%; height: 100%; overflow: hidden; }
  body {
    font-family: 'Porsche Next TT', 'Helvetica Neue', Arial, sans-serif;
    background: #404044;
    color: #fff;
  }

  /* Container and Layout */
  .container {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Slide Title */
  .slide-title {
    position: absolute;
    top: 48px;
    left: 0;
    right: 0;
    font-size: 48px;
    font-weight: 700;
    line-height: 1.1;
    text-align: center;
    color: #fff;
  }

  /* Center Circle */
  .center-circle {
    position: absolute;
    width: 280px;
    height: 280px;
    border-radius: 50%;
    background: #5d5d5d;
    box-shadow: 0 0 24px rgba(0,0,0,0.24);
    border: 4px solid #010205;
    overflow: hidden;
    z-index: 1;
  }

  .center-circle img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  /* Connecting Lines SVG */
  .connecting-lines {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
  }
  .connecting-lines line {
    stroke: #000;
    stroke-width: 2;
    stroke-dasharray: 8 4;
    opacity: 0.3;
  }

  /* Outer Circles */
  .outer-circle {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    z-index: 2;
  }

  .circle-button {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background-color: #d5001c;
    border: 2px solid #6b6d70;
    box-shadow: 0 0 24px rgba(0,0,0,0.24);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 300ms ease, box-shadow 300ms ease;
    color: white;
  }

  .circle-button:hover {
    transform: scale(1.1);
    box-shadow: 0 0 32px rgba(0,0,0,0.35);
  }

  .circle-button:active {
    transform: scale(1.05);
  }

  .circle-button:focus {
    outline: none;
    box-shadow: 0 0 0 4px rgba(213, 0, 28, 0.5), 0 0 24px rgba(0,0,0,0.24);
  }

  .circle-button img,
  .circle-button svg {
    width: 48px;
    height: 48px;
  }

  .circle-label {
    background-color: #d5001c;
    border: 1px solid #6b6d70;
    border-radius: 4px;
    padding: 8px 16px;
    color: white;
    font-size: 14px;
    font-weight: 500;
    white-space: nowrap;
    box-shadow: 0 0 24px rgba(0,0,0,0.24);
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 50;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    animation: fadeIn 200ms ease;
  }

  .modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-content {
    background-color: #2a2a2e;
    border-radius: 8px;
    max-width: 672px;
    width: 90%;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3);
    animation: modalZoomIn 200ms ease;
  }

  .modal-header {
    position: sticky;
    top: 0;
    background-color: #2a2a2e;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding: 24px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 16px;
  }

  .modal-header h2 {
    font-size: 24px;
    font-weight: 600;
    color: #fff;
    margin: 0;
  }

  .close-button {
    background: rgba(255,255,255,0.1);
    border: none;
    font-size: 24px;
    color: #fff;
    cursor: pointer;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    transition: background-color 200ms;
    flex-shrink: 0;
  }

  .close-button:hover {
    background-color: rgba(255,255,255,0.2);
  }

  .modal-body {
    padding: 24px;
  }

  .modal-body p {
    color: rgba(255,255,255,0.9);
    line-height: 1.6;
    margin-bottom: 16px;
    font-size: 16px;
  }

  .modal-body h3 {
    color: #fff;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 12px;
  }

  .modal-body ul {
    list-style: none;
    padding-left: 0;
    color: rgba(255,255,255,0.85);
  }

  .modal-body ul li {
    margin-bottom: 8px;
    padding-left: 16px;
    position: relative;
    font-size: 15px;
    line-height: 1.5;
  }

  .modal-body ul li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 8px;
    width: 6px;
    height: 6px;
    background: #d5001c;
    border-radius: 50%;
  }

  .modal-image {
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 16px;
  }

  .modal-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes modalZoomIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
</style>
</head>
<body>
  <section class="slide slide-circle-hub" data-slide-id="{{ slide.id }}" data-intro-animation="{{ slide.intro_animation }}">

    {% if slide.slide_title %}
    <h1 class="slide-title" data-anim-item>{{ slide.slide_title }}</h1>
    {% endif %}

    <div class="container" data-anim-item>
      <!-- Connecting Lines SVG -->
      <svg class="connecting-lines" id="connectingLines"></svg>

      <!-- Center Circle -->
      <div class="center-circle">
        {% set center_img = slide.raw.get('Center-Image', '') %}
        {% if center_img %}
        <img src="{{ center_img }}" alt="Center image">
        {% else %}
        <div style="width:100%;height:100%;background:#3e4146;display:flex;align-items:center;justify-content:center;">
          <span style="font-size:14px;color:rgba(255,255,255,0.5);">Image</span>
        </div>
        {% endif %}
      </div>

      <!-- Outer Circles -->
      {% for i in range(1, 9) %}
      {% set prefix = 'Circle-' ~ i ~ '-' %}
      {% set label = slide.raw.get(prefix ~ 'Label', '') %}
      {% if label %}
      <div class="outer-circle" data-position="{{ slide.raw.get(prefix ~ 'Position', (i - 1) * 72) }}" data-modal="modal{{ i }}">
        <button class="circle-button" aria-label="Open {{ label }}">
          {% set icon = slide.raw.get(prefix ~ 'Icon', '') %}
          {% if icon %}
          <img src="../assets/icons/{{ icon }}" alt="">
          {% else %}
          <svg viewBox="0 0 24 24" fill="white"><circle cx="12" cy="12" r="4"/></svg>
          {% endif %}
        </button>
        <div class="circle-label">{{ label }}</div>
      </div>

      <!-- Modal for Circle {{ i }} -->
      <div id="modal{{ i }}" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>{{ slide.raw.get(prefix ~ 'Headline', label) }}</h2>
            <button class="close-button" aria-label="Close">&times;</button>
          </div>
          <div class="modal-body">
            {% set modal_img = slide.raw.get(prefix ~ 'Image', '') %}
            {% if modal_img %}
            <div class="modal-image">
              <img src="{{ modal_img }}" alt="">
            </div>
            {% endif %}

            {% for p in range(1, 5) %}
            {% set para = slide.raw.get(prefix ~ 'Paragraph-' ~ p, '') %}
            {% if para %}
            <p>{{ para }}</p>
            {% endif %}
            {% endfor %}

            {% set list_title = slide.raw.get(prefix ~ 'List-Title', '') %}
            {% set has_list_items = slide.raw.get(prefix ~ 'List-Item-1', '') %}
            {% if has_list_items %}
            {% if list_title %}
            <h3>{{ list_title }}</h3>
            {% endif %}
            <ul>
              {% for li in range(1, 9) %}
              {% set item = slide.raw.get(prefix ~ 'List-Item-' ~ li, '') %}
              {% if item %}
              <li>{{ item }}</li>
              {% endif %}
              {% endfor %}
            </ul>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </section>

  <script src="../assets/vendor/gsap/gsap.min.js"></script>
  <script src="../assets/js/slide-runtime.js"></script>
  <script>
  (function() {
    const radius = {{ slide.raw.get('Radius', 320) }};

    // Position circles and draw connecting lines
    function positionCircles() {
      const container = document.querySelector('.container');
      const centerX = container.offsetWidth / 2;
      const centerY = container.offsetHeight / 2;
      const linesContainer = document.getElementById('connectingLines');

      // Clear existing lines
      linesContainer.innerHTML = '';

      document.querySelectorAll('.outer-circle').forEach(circle => {
        const angle = parseInt(circle.dataset.position);
        const radians = ((angle - 90) * Math.PI) / 180;

        const x = centerX + Math.cos(radians) * radius;
        const y = centerY + Math.sin(radians) * radius;

        circle.style.left = x + 'px';
        circle.style.top = y + 'px';
        circle.style.transform = 'translate(-50%, -50%)';

        // Draw connecting line
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', centerX);
        line.setAttribute('y1', centerY);
        line.setAttribute('x2', x);
        line.setAttribute('y2', y);
        linesContainer.appendChild(line);
      });
    }

    // Modal functionality
    function setupModals() {
      // Open modal on circle click
      document.querySelectorAll('.circle-button').forEach(button => {
        button.addEventListener('click', (e) => {
          const outerCircle = e.currentTarget.closest('.outer-circle');
          const modalId = outerCircle.dataset.modal;
          const modal = document.getElementById(modalId);

          if (modal) {
            modal.classList.add('active');
            modal.querySelector('.close-button').focus();
          }
        });
      });

      // Close modal on X click
      document.querySelectorAll('.close-button').forEach(button => {
        button.addEventListener('click', (e) => {
          const modal = e.target.closest('.modal');
          closeModal(modal);
        });
      });

      // Close modal on backdrop click
      document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            closeModal(modal);
          }
        });
      });

      // Close modal on ESC key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const activeModal = document.querySelector('.modal.active');
          if (activeModal) {
            closeModal(activeModal);
          }
        }
      });
    }

    function closeModal(modal) {
      modal.classList.remove('active');
      // Return focus to the button that opened it
      const modalId = modal.id;
      const trigger = document.querySelector(`[data-modal="${modalId}"] .circle-button`);
      if (trigger) trigger.focus();
    }

    // Initialize
    positionCircles();
    setupModals();
    window.addEventListener('resize', positionCircles);
  })();
  </script>
</body>
</html>
